<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Creative - Start Bootstrap Theme</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom fonts for this template -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">CastAway V2.0</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#about">About</a>
            </li>
            <li class="nav-item">
              <a id"servicesBtn" class="nav-link js-scroll-trigger" href="#services">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#portfolio">Portfolio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="masthead text-center text-white d-flex">
      <div class="container my-auto">
        <div class="row">
          <div class="col-lg-10 mx-auto">
            <h1 class="text-uppercase">
              <strong id="cast_setup_title">CastAway Receiver V2.0</strong>
            </h1>
            <hr>
          </div>
          <div id="debug" class="col-lg-8 mx-auto">
          </div>
        </div>
      </div>
    </header>
    <section id="services">
      <div class="container" id="top_of_song" style="padding-top:78px;">
        <span id="song_title"></span> by <span id="song_artist"></span>
      </div>
      <div class="container" id="wrap">
      </div>
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-6 text-center">
            <div class="service-box mt-5 mx-auto">
              <i class="fa fa-4x fa-diamond text-primary mb-3 sr-icons"></i>
              <h3 class="mb-3">Sturdy Templates</h3>
              <p class="text-muted mb-0">Our templates are updated regularly so they don't break.</p>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 text-center">
            <div class="service-box mt-5 mx-auto">
              <i class="fa fa-4x fa-paper-plane text-primary mb-3 sr-icons"></i>
              <h3 class="mb-3">Ready to Ship</h3>
              <p class="text-muted mb-0">You can use this theme as is, or you can make changes!</p>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 text-center">
            <div class="service-box mt-5 mx-auto">
              <i class="fa fa-4x fa-newspaper-o text-primary mb-3 sr-icons"></i>
              <h3 class="mb-3">Up to Date</h3>
              <p class="text-muted mb-0">We update dependencies to keep things fresh.</p>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 text-center">
            <div class="service-box mt-5 mx-auto">
              <i class="fa fa-4x fa-heart text-primary mb-3 sr-icons"></i>
              <h3 class="mb-3">Made with Love</h3>
              <p class="text-muted mb-0">You have to make your websites with love these days!</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 ml-auto text-center">
            <i class="fa fa-phone fa-3x mb-3 sr-contact"></i>
            <p>123-456-6789</p>
          </div>
          <div class="col-lg-4 mr-auto text-center">
            <i class="fa fa-envelope-o fa-3x mb-3 sr-contact"></i>
            <p>
              <a href="mailto:your-email@your-domain.com">feedback@startbootstrap.com</a>
            </p>
          </div>
        </div>
      </div>
    </section>


    <section class="bg-primary" id="about">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
            <h2 class="section-heading text-white">We've got what you need!</h2>
            <hr class="light my-4">
            <p class="text-faded mb-4">Start Bootstrap has everything you need to get your new website up and running in no time! All of the templates and themes on Start Bootstrap are open source, free to download, and easy to use. No strings attached!</p>
            <a class="btn btn-light btn-xl js-scroll-trigger" href="#services">Get Started!</a>
          </div>
        </div>
      </div>
    </section>




    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.20.0.min.js"></script>

    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>


    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js" integrity="sha384-feJI7QwhOS+hwpX2zkaeJQjeiwlhOP+SdQDqhgvvo1DsjtiSQByFdThsxO669S2D" crossorigin="anonymous"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.compatibility.min.js"></script>
    -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollReveal.js/3.3.6/scrollreveal.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/common.js"></script>
    <script type="text/javascript">
      function log(message) {
        //console.log(message);
        $("#debug").append("<div>"+ JSON.stringify(message) + "</div>" );
      }
      $( document ).ready(function(){
        xApp.initReceiver = function(){
          //window.onload = function() {
          cast.receiver.logger.setLevelValue(0);
          window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
          log('Starting Receiver Manager');

          //xApp.loadMsg("Starting CastAway Receiver")

          // handler for the 'ready' event
          castReceiverManager.onReady = function(event) {
            log('Received Ready event: ' + JSON.stringify(event.data));
            window.castReceiverManager.setApplicationState('Application status is ready...');
          };
          // handler for 'senderconnected' event
          castReceiverManager.onSenderConnected = function(event) {
            log('Received Sender Connected event: ' + event.data);
            log(window.castReceiverManager.getSender(event.data).userAgent);
          };
          // handler for 'senderdisconnected' event
          castReceiverManager.onSenderDisconnected = function(event) {
            log('Received Sender Disconnected event: ' + event.data);
            if (window.castReceiverManager.getSenders().length == 0) {
              window.close();
            }
          };
          // handler for 'systemvolumechanged' event
          castReceiverManager.onSystemVolumeChanged = function(event) {
            log('Received System Volume Changed event: ' + event.data['level'] + ' ' + event.data['muted']);
          };
          // create a CastMessageBus to handle messages for a custom namespace
          window.messageBus = window.castReceiverManager.getCastMessageBus( 'urn:x-cast:com.google.cast.sample.castaway');
          // handler for the CastMessageBus message event
          window.messageBus.onMessage = function(event) {
            log('Message [' + event.senderId + ']: ' + event.data);
            if ( event.data.substr(0,4)==="xApp" ){
            	try {
            	  var p = event.data.substr(5).split(/:/);
            	  return xApp[ p[0] ]( p.slice(1).join(":") );
            	}
            	catch(xErr){
            		log("Got xErr");
            	  log("xApp."+event.data.substr(5) + " not available")
            	}
            }
            /*
            xApp.loadMsg("Got message");
            xApp.loadMsg(event.data);
            */
            window.messageBus.send(event.senderId, "FROM RC"+event.data);
          }
          // initialize the CastReceiverManager with an application status message
          window.castReceiverManager.start({statusText: 'Application is starting'});
          log('Receiver Manager started');
          //};
        }

        xApp.initPubNub =  function(){
          xApp.pubnub = new PubNub({
            subscribeKey: 'sub-b8449342-0962-11e1-bec7-05a8a56cd07c', // always required
            publishKey: 'pub-4f2959b6-ad9f-4c3a-a7d6-39aa4232d153' // only required if publishing
          });

          xApp.pubnub.addListener({
            status: function(se){  
              console.log('se');
              console.log(se);
              $("#titleRight").text(se.category);
            },
            message: function(msg){
              log("got pubnub msg")
              $("#titleLeft").text("Received message from PubNub");
              log(msg);
              msg = msg.message;
              switch(msg.kind){
                case "search": 
                  // to notify sender that a search was done via alexa, RECEIVER don't do anytihg
                  return; 
                case "chords": 
                  $("#song_title").text(msg.title);
                  $("#song_artist").text(msg.artist);
                  console.log("got path:"+msg.pathToChords);

                  return xApp.ajaxChords(msg.pathToChords);
                case "state":
                  return xApp.loadMsg(msg.txt);
                case "transpose":
                  $("#wrap").hide();
                  $("#stateDiv").html("transposing " + msg.dir + " " + msg.steps + " half steps").fadeIn();
                 
                  for(var i =0 ; i < msg.steps; i++){ step(msg.dir); };
                  setTimeout(function(){
                    $("#stateDiv").hide();
                    $("#wrap").fadeIn(300);
                  },3000);
                  return ;
                default:
                          
                  break;
              }
            }
          });
          xApp.pubnub.subscribe({ channels: ['castaway'] });
        }

      	xApp.initReceiver();
      	xApp.initPubNub();
      })
    </script>

  </body>

</html>
